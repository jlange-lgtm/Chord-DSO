{
  "name": "RecordManagementTool",
  "description": "Manages patient records including creation, updates, email verification, and logging issues. Handles new patient registration, patient information updates, and email validation. Also logs issues to designated email addresses.",
  "color": "linear-gradient(rgb(68,211,235), rgb(86,81,165))",
  "iconSrc": "",
  "schema": "[{\"id\":0,\"property\":\"operation\",\"type\":\"string\",\"description\":\"Operation: 'createPatient', 'updatePatient', 'verifyEmail', 'logIssue' (required)\",\"required\":true},{\"id\":1,\"property\":\"patientId\",\"type\":\"string\",\"description\":\"Patient ID for update operations\",\"required\":false},{\"id\":2,\"property\":\"firstName\",\"type\":\"string\",\"description\":\"Patient's first name (required for create)\",\"required\":false},{\"id\":3,\"property\":\"lastName\",\"type\":\"string\",\"description\":\"Patient's last name (required for create)\",\"required\":false},{\"id\":4,\"property\":\"dateOfBirth\",\"type\":\"string\",\"description\":\"Date of birth in YYYY-MM-DD format (required for create)\",\"required\":false},{\"id\":5,\"property\":\"phoneNumber\",\"type\":\"string\",\"description\":\"Primary phone number (required for create)\",\"required\":false},{\"id\":6,\"property\":\"email\",\"type\":\"string\",\"description\":\"Email address (for create/update/verify)\",\"required\":false},{\"id\":7,\"property\":\"insuranceName\",\"type\":\"string\",\"description\":\"Insurance provider name\",\"required\":false},{\"id\":8,\"property\":\"insuranceGroupId\",\"type\":\"string\",\"description\":\"Insurance group ID\",\"required\":false},{\"id\":9,\"property\":\"notes\",\"type\":\"string\",\"description\":\"Patient notes (e.g., 'Pay out of pocket')\",\"required\":false},{\"id\":10,\"property\":\"issueDescription\",\"type\":\"string\",\"description\":\"Issue description for logging (required for logIssue)\",\"required\":false},{\"id\":11,\"property\":\"issueEmail\",\"type\":\"string\",\"description\":\"Email address to send issue to (default: svirgulti@chordsdp.com)\",\"required\":false}]",
  "func": "/*\n* Record Management Tool - Patient record operations\n* You can use properties: $operation, $patientId, $firstName, $lastName, $dateOfBirth, $phoneNumber, $email, $insuranceName, $insuranceGroupId, $notes, $issueDescription, $issueEmail\n* Must return a string value at the end of function\n*/\n\n// Sample patient records database\nconst patientRecords = [\n  {\n    patientId: 'PAT001',\n    firstName: 'Emma',\n    lastName: 'Johnson',\n    dateOfBirth: '2010-05-15',\n    phoneNumber: '2155551234',\n    email: 'emma.johnson@email.com',\n    emailVerified: true,\n    insuranceName: 'Blue Cross Blue Shield',\n    insuranceGroupId: 'BC123456',\n    notes: '',\n    createdAt: '2023-01-15T10:00:00Z',\n    updatedAt: '2024-11-01T14:30:00Z'\n  },\n  {\n    patientId: 'PAT002',\n    firstName: 'Michael',\n    lastName: 'Rodriguez',\n    dateOfBirth: '2012-08-22',\n    phoneNumber: '2155552345',\n    email: 'michael.r@email.com',\n    emailVerified: true,\n    insuranceName: null,\n    insuranceGroupId: null,\n    notes: 'Pay out of pocket',\n    createdAt: '2023-03-20T09:15:00Z',\n    updatedAt: '2024-10-15T11:20:00Z'\n  }\n];\n\n// Email validation\nfunction isValidEmail(email) {\n  if (!email) return false;\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n  return emailRegex.test(email);\n}\n\n// Generate patient ID\nfunction generatePatientId() {\n  const nextNum = patientRecords.length + 1;\n  return `PAT${String(nextNum).padStart(3, '0')}`;\n}\n\n// Calculate age from DOB\nfunction calculateAge(dateOfBirth) {\n  const dob = new Date(dateOfBirth);\n  const today = new Date();\n  let age = today.getFullYear() - dob.getFullYear();\n  const monthDiff = today.getMonth() - dob.getMonth();\n  if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < dob.getDate())) {\n    age--;\n  }\n  return age;\n}\n\ntry {\n  const operation = $operation;\n  \n  if (!operation) {\n    return JSON.stringify({\n      success: false,\n      error: 'Operation is required',\n      message: 'Please specify an operation: createPatient, updatePatient, verifyEmail, or logIssue'\n    });\n  }\n  \n  switch (operation) {\n    case 'createPatient': {\n      const firstName = $firstName;\n      const lastName = $lastName;\n      const dateOfBirth = $dateOfBirth;\n      const phoneNumber = $phoneNumber;\n      const email = $email || null;\n      const insuranceName = $insuranceName || null;\n      const insuranceGroupId = $insuranceGroupId || null;\n      const notes = $notes || '';\n      \n      // Validate required fields\n      if (!firstName || !lastName || !dateOfBirth || !phoneNumber) {\n        return JSON.stringify({\n          success: false,\n          error: 'Missing required fields',\n          message: 'First name, last name, date of birth, and phone number are required'\n        });\n      }\n      \n      // Validate email format if provided\n      if (email && !isValidEmail(email)) {\n        return JSON.stringify({\n          success: false,\n          error: 'Invalid email format',\n          message: 'Please provide a valid email address'\n        });\n      }\n      \n      // Check age restriction\n      const age = calculateAge(dateOfBirth);\n      if (age >= 17) {\n        return JSON.stringify({\n          success: false,\n          error: 'Age restriction',\n          message: 'Patient must be 16 or younger for pediatric care',\n          patientAge: age\n        });\n      }\n      \n      // Check if patient already exists\n      const existingPatient = patientRecords.find(p => \n        p.phoneNumber === phoneNumber || \n        (p.firstName.toLowerCase() === firstName.toLowerCase() && \n         p.lastName.toLowerCase() === lastName.toLowerCase() &&\n         p.dateOfBirth === dateOfBirth)\n      );\n      \n      if (existingPatient) {\n        return JSON.stringify({\n          success: false,\n          error: 'Patient already exists',\n          message: 'A patient record with this information already exists',\n          existingPatientId: existingPatient.patientId\n        });\n      }\n      \n      // Create new patient record\n      const newPatientId = generatePatientId();\n      const newPatient = {\n        patientId: newPatientId,\n        firstName: firstName,\n        lastName: lastName,\n        dateOfBirth: dateOfBirth,\n        phoneNumber: phoneNumber,\n        email: email,\n        emailVerified: email ? false : null,\n        insuranceName: insuranceName,\n        insuranceGroupId: insuranceGroupId,\n        notes: notes,\n        createdAt: new Date().toISOString(),\n        updatedAt: new Date().toISOString()\n      };\n      \n      patientRecords.push(newPatient);\n      \n      return JSON.stringify({\n        success: true,\n        operation: 'createPatient',\n        patient: {\n          patientId: newPatientId,\n          firstName: firstName,\n          lastName: lastName,\n          fullName: `${firstName} ${lastName}`,\n          dateOfBirth: dateOfBirth,\n          age: age,\n          phoneNumber: phoneNumber,\n          email: email,\n          emailVerified: newPatient.emailVerified,\n          insuranceName: insuranceName,\n          insuranceGroupId: insuranceGroupId,\n          notes: notes\n        },\n        message: `Patient record created successfully. Patient ID: ${newPatientId}`\n      }, null, 2);\n    }\n    \n    case 'updatePatient': {\n      const patientId = $patientId;\n      \n      if (!patientId) {\n        return JSON.stringify({\n          success: false,\n          error: 'Patient ID is required'\n        });\n      }\n      \n      const patient = patientRecords.find(p => p.patientId === patientId);\n      \n      if (!patient) {\n        return JSON.stringify({\n          success: false,\n          error: 'Patient not found',\n          message: `No patient found with ID: ${patientId}`\n        });\n      }\n      \n      // Update fields if provided\n      if ($email !== undefined) {\n        if ($email && !isValidEmail($email)) {\n          return JSON.stringify({\n            success: false,\n            error: 'Invalid email format'\n          });\n        }\n        patient.email = $email || null;\n        patient.emailVerified = $email ? false : null;\n      }\n      \n      if ($insuranceName !== undefined) patient.insuranceName = $insuranceName || null;\n      if ($insuranceGroupId !== undefined) patient.insuranceGroupId = $insuranceGroupId || null;\n      if ($notes !== undefined) patient.notes = $notes || '';\n      if ($phoneNumber !== undefined) patient.phoneNumber = $phoneNumber;\n      \n      patient.updatedAt = new Date().toISOString();\n      \n      return JSON.stringify({\n        success: true,\n        operation: 'updatePatient',\n        patient: {\n          patientId: patient.patientId,\n          firstName: patient.firstName,\n          lastName: patient.lastName,\n          email: patient.email,\n          emailVerified: patient.emailVerified,\n          insuranceName: patient.insuranceName,\n          insuranceGroupId: patient.insuranceGroupId,\n          notes: patient.notes\n        },\n        message: 'Patient record updated successfully'\n      }, null, 2);\n    }\n    \n    case 'verifyEmail': {\n      const patientId = $patientId;\n      const email = $email;\n      \n      if (!patientId) {\n        return JSON.stringify({\n          success: false,\n          error: 'Patient ID is required'\n        });\n      }\n      \n      const patient = patientRecords.find(p => p.patientId === patientId);\n      \n      if (!patient) {\n        return JSON.stringify({\n          success: false,\n          error: 'Patient not found'\n        });\n      }\n      \n      // Check if email matches\n      const emailMatches = email && patient.email && \n        email.toLowerCase() === patient.email.toLowerCase();\n      \n      if (!emailMatches && email) {\n        // Log email mismatch issue\n        const issueEmail = $issueEmail || 'svirgulti@chordsdp.com';\n        // In real system, this would send an email\n        console.log(`Email mismatch logged for ${issueEmail}: Patient ${patientId} email mismatch`);\n      }\n      \n      patient.emailVerified = emailMatches;\n      patient.updatedAt = new Date().toISOString();\n      \n      return JSON.stringify({\n        success: true,\n        operation: 'verifyEmail',\n        patientId: patientId,\n        emailMatches: emailMatches,\n        patientEmail: patient.email,\n        providedEmail: email,\n        emailVerified: patient.emailVerified,\n        message: emailMatches ? 'Email verified successfully' : 'Email does not match patient record'\n      }, null, 2);\n    }\n    \n    case 'logIssue': {\n      const issueDescription = $issueDescription;\n      const issueEmail = $issueEmail || 'svirgulti@chordsdp.com';\n      \n      if (!issueDescription) {\n        return JSON.stringify({\n          success: false,\n          error: 'Issue description is required'\n        });\n      }\n      \n      // In real system, this would send an email\n      const issueLog = {\n        timestamp: new Date().toISOString(),\n        email: issueEmail,\n        description: issueDescription,\n        logged: true\n      };\n      \n      console.log('Issue logged:', issueLog);\n      \n      return JSON.stringify({\n        success: true,\n        operation: 'logIssue',\n        issue: issueLog,\n        message: `Issue logged and sent to ${issueEmail}`\n      }, null, 2);\n    }\n    \n    default:\n      return JSON.stringify({\n        success: false,\n        error: 'Invalid operation',\n        message: `Unknown operation: ${operation}. Valid operations: createPatient, updatePatient, verifyEmail, logIssue`\n      });\n  }\n  \n} catch (error) {\n  console.error('Record management error:', error);\n  return JSON.stringify({\n    success: false,\n    error: error.message,\n    message: 'Record management operation temporarily unavailable. Please try again.'\n  });\n}",
  "workspaceId": "9e7c759d-2623-4529-945d-6c578631aad0"
}

