{
  "name": "ExternalTriggerTool",
  "description": "Triggers external systems and services, specifically the NextHealth confirmation and reminder system. Sends appointment confirmation data to NextHealth for automated text message reminders and confirmations.",
  "color": "linear-gradient(rgb(68,211,235), rgb(86,81,165))",
  "iconSrc": "",
  "schema": "[{\"id\":0,\"property\":\"service\",\"type\":\"string\",\"description\":\"External service to trigger: 'NextHealth' (required)\",\"required\":true},{\"id\":1,\"property\":\"appointmentId\",\"type\":\"string\",\"description\":\"Appointment ID to send confirmation for (required)\",\"required\":true},{\"id\":2,\"property\":\"patientId\",\"type\":\"string\",\"description\":\"Patient ID (required)\",\"required\":true},{\"id\":3,\"property\":\"patientPhone\",\"type\":\"string\",\"description\":\"Patient phone number for text reminders (required)\",\"required\":true},{\"id\":4,\"property\":\"appointmentDate\",\"type\":\"string\",\"description\":\"Appointment date in YYYY-MM-DD format (required)\",\"required\":true},{\"id\":5,\"property\":\"appointmentTime\",\"type\":\"string\",\"description\":\"Appointment time in HH:MM format (required)\",\"required\":true},{\"id\":6,\"property\":\"appointmentType\",\"type\":\"string\",\"description\":\"Type of appointment\",\"required\":false},{\"id\":7,\"property\":\"location\",\"type\":\"string\",\"description\":\"Appointment location\",\"required\":false}]",
  "func": "/*\n* External Trigger Tool - Trigger NextHealth and other external systems\n* You can use properties: $service, $appointmentId, $patientId, $patientPhone, $appointmentDate, $appointmentTime, $appointmentType, $location\n* Must return a string value at the end of function\n*/\n\n// NextHealth API endpoint (sample)\nconst NEXTHEALTH_API_URL = 'https://api.nexthealth.com/v1/appointments/confirm';\n\ntry {\n  const service = $service;\n  \n  if (!service) {\n    return JSON.stringify({\n      success: false,\n      error: 'Service is required',\n      message: 'Please specify a service to trigger (e.g., NextHealth)'\n    });\n  }\n  \n  if (service.toLowerCase() !== 'nexthealth') {\n    return JSON.stringify({\n      success: false,\n      error: 'Unsupported service',\n      message: `Service '${service}' is not supported. Currently only 'NextHealth' is available.`\n    });\n  }\n  \n  // Validate required fields for NextHealth\n  const appointmentId = $appointmentId;\n  const patientId = $patientId;\n  const patientPhone = $patientPhone;\n  const appointmentDate = $appointmentDate;\n  const appointmentTime = $appointmentTime;\n  \n  if (!appointmentId || !patientId || !patientPhone || !appointmentDate || !appointmentTime) {\n    return JSON.stringify({\n      success: false,\n      error: 'Missing required fields',\n      message: 'Appointment ID, Patient ID, Patient Phone, Appointment Date, and Appointment Time are required for NextHealth trigger'\n    });\n  }\n  \n  // Validate date format\n  if (!/^\\d{4}-\\d{2}-\\d{2}$/.test(appointmentDate)) {\n    return JSON.stringify({\n      success: false,\n      error: 'Invalid date format',\n      message: 'Appointment date must be in YYYY-MM-DD format'\n    });\n  }\n  \n  // Validate time format\n  if (!/^\\d{1,2}:\\d{2}$/.test(appointmentTime)) {\n    return JSON.stringify({\n      success: false,\n      error: 'Invalid time format',\n      message: 'Appointment time must be in HH:MM format'\n    });\n  }\n  \n  // Prepare NextHealth payload\n  const nextHealthPayload = {\n    appointmentId: appointmentId,\n    patientId: patientId,\n    patientPhone: patientPhone,\n    appointmentDate: appointmentDate,\n    appointmentTime: appointmentTime,\n    appointmentType: $appointmentType || 'General',\n    location: $location || 'Allegheny Avenue',\n    triggerType: 'confirmation_and_reminder',\n    timestamp: new Date().toISOString()\n  };\n  \n  // In real system, this would make an HTTP POST request to NextHealth API\n  // const fetch = require('node-fetch');\n  // const response = await fetch(NEXTHEALTH_API_URL, {\n  //   method: 'POST',\n  //   headers: { 'Content-Type': 'application/json' },\n  //   body: JSON.stringify(nextHealthPayload)\n  // });\n  \n  // Simulate successful API call\n  const triggerResult = {\n    service: 'NextHealth',\n    status: 'triggered',\n    payload: nextHealthPayload,\n    confirmationSent: true,\n    reminderScheduled: true,\n    reminderDate: new Date(new Date(appointmentDate).getTime() - 24 * 60 * 60 * 1000).toISOString().split('T')[0], // 24 hours before\n    message: `Confirmation and reminder triggered for appointment ${appointmentId}`\n  };\n  \n  return JSON.stringify({\n    success: true,\n    operation: 'triggerExternalService',\n    result: triggerResult,\n    message: `NextHealth confirmation and reminder system triggered successfully. Text confirmation will be sent to ${patientPhone}.`\n  }, null, 2);\n  \n} catch (error) {\n  console.error('External trigger error:', error);\n  return JSON.stringify({\n    success: false,\n    error: error.message,\n    message: 'External service trigger temporarily unavailable. Please try again.'\n  });\n}",
  "workspaceId": "9e7c759d-2623-4529-945d-6c578631aad0"
}

