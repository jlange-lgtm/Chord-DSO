{
  "name": "PatientMatchTool",
  "description": "Identifies and matches patients using Automatic Number Identification (ANI), Date of Birth (DOB), and alternate phone numbers. Returns patient information including name, patient ID, appointment status, and location context. This tool MUST be called before accessing any patient records or appointment information.",
  "color": "linear-gradient(rgb(68,211,235), rgb(86,81,165))",
  "iconSrc": "",
  "schema": "[{\"id\":0,\"property\":\"phoneNumber\",\"type\":\"string\",\"description\":\"Phone number to lookup (ANI or alternate phone number)\",\"required\":true},{\"id\":1,\"property\":\"dateOfBirth\",\"type\":\"string\",\"description\":\"Patient's date of birth in format YYYY-MM-DD or MM/DD/YYYY (optional, used for verification)\",\"required\":false},{\"id\":2,\"property\":\"matchType\",\"type\":\"string\",\"description\":\"Type of match: 'ANI_ONLY', 'ANI_DOB', 'ALT_PHONE' (default: 'ANI_ONLY')\",\"required\":false}]",
  "func": "/*\n* Patient Match Tool - Identifies patients using ANI, DOB, and alternate phone numbers\n* You can use properties: $phoneNumber, $dateOfBirth, $matchType\n* Must return a string value at the end of function\n*/\n\n// Sample patient database\nconst samplePatients = [\n  {\n    patientId: 'PAT001',\n    firstName: 'Emma',\n    lastName: 'Johnson',\n    primaryPhone: '2155551234',\n    alternatePhones: ['2155555678'],\n    dateOfBirth: '2010-05-15',\n    location: 'Allegheny Avenue',\n    hasUpcomingAppointment: true,\n    nextAppointment: {\n      id: 'APT001',\n      date: '2025-12-15',\n      time: '10:00 AM',\n      type: 'Cleaning',\n      provider: 'Dr. Smith'\n    },\n    email: 'emma.johnson@email.com',\n    isExistingPatient: true\n  },\n  {\n    patientId: 'PAT002',\n    firstName: 'Michael',\n    lastName: 'Rodriguez',\n    primaryPhone: '2155552345',\n    alternatePhones: [],\n    dateOfBirth: '2012-08-22',\n    location: 'West Philadelphia',\n    hasUpcomingAppointment: false,\n    nextAppointment: null,\n    email: 'michael.r@email.com',\n    isExistingPatient: true\n  },\n  {\n    patientId: 'PAT003',\n    firstName: 'Sophia',\n    lastName: 'Chen',\n    primaryPhone: '2155553456',\n    alternatePhones: ['2155557890'],\n    dateOfBirth: '2015-03-10',\n    location: 'Allegheny Avenue',\n    hasUpcomingAppointment: true,\n    nextAppointment: {\n      id: 'APT002',\n      date: '2026-01-10',\n      time: '2:30 PM',\n      type: 'New Patient Exam',\n      provider: 'Dr. Williams'\n    },\n    email: 'sophia.chen@email.com',\n    isExistingPatient: true\n  },\n  {\n    patientId: 'PAT004',\n    firstName: 'James',\n    lastName: 'Wilson',\n    primaryPhone: '2155554567',\n    alternatePhones: [],\n    dateOfBirth: '2008-11-05',\n    location: 'Allegheny Avenue',\n    hasUpcomingAppointment: true,\n    nextAppointment: {\n      id: 'APT003',\n      date: '2026-02-20',\n      time: '9:00 AM',\n      type: 'Ortho Consult',\n      provider: 'Dr. Brown'\n    },\n    email: 'james.wilson@email.com',\n    isExistingPatient: true\n  }\n];\n\n// Normalize phone number\nfunction normalizePhone(phone) {\n  if (!phone) return null;\n  // Remove all non-digit characters\n  const cleaned = phone.replace(/\\D/g, '');\n  // Handle 10-digit and 11-digit numbers\n  if (cleaned.length === 11 && cleaned.startsWith('1')) {\n    return cleaned.substring(1);\n  }\n  return cleaned.length === 10 ? cleaned : null;\n}\n\n// Normalize date of birth\nfunction normalizeDOB(dob) {\n  if (!dob) return null;\n  // Handle YYYY-MM-DD format\n  if (/^\\d{4}-\\d{2}-\\d{2}$/.test(dob)) {\n    return dob;\n  }\n  // Handle MM/DD/YYYY format\n  const match = dob.match(/^(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})$/);\n  if (match) {\n    const [, month, day, year] = match;\n    return `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;\n  }\n  return null;\n}\n\n// Check if DOB matches\nfunction dobMatches(patientDOB, providedDOB) {\n  if (!providedDOB) return true; // No DOB provided, match by phone only\n  const normalizedProvided = normalizeDOB(providedDOB);\n  const normalizedPatient = normalizeDOB(patientDOB);\n  return normalizedProvided === normalizedPatient;\n}\n\ntry {\n  const phoneNumber = normalizePhone($phoneNumber);\n  const dateOfBirth = $dateOfBirth || null;\n  const matchType = $matchType || 'ANI_ONLY';\n  \n  if (!phoneNumber) {\n    return JSON.stringify({\n      success: false,\n      error: 'Invalid phone number format',\n      message: 'Please provide a valid 10-digit phone number'\n    });\n  }\n  \n  // Search for matching patients\n  const matches = [];\n  \n  for (const patient of samplePatients) {\n    let isMatch = false;\n    \n    // Check primary phone\n    if (normalizePhone(patient.primaryPhone) === phoneNumber) {\n      isMatch = true;\n    }\n    \n    // Check alternate phones\n    if (!isMatch && patient.alternatePhones) {\n      for (const altPhone of patient.alternatePhones) {\n        if (normalizePhone(altPhone) === phoneNumber) {\n          isMatch = true;\n          break;\n        }\n      }\n    }\n    \n    // If phone matches, check DOB if provided\n    if (isMatch) {\n      if (matchType === 'ANI_DOB' && dateOfBirth) {\n        if (!dobMatches(patient.dateOfBirth, dateOfBirth)) {\n          continue; // Skip if DOB doesn't match\n        }\n      }\n      matches.push(patient);\n    }\n  }\n  \n  // Handle results\n  if (matches.length === 0) {\n    return JSON.stringify({\n      success: false,\n      matchFound: false,\n      message: 'No patient record found matching the provided information',\n      suggestion: matchType === 'ANI_ONLY' && !dateOfBirth ? 'Try providing Date of Birth for verification' : 'Verify phone number or contact office'\n    });\n  }\n  \n  if (matches.length === 1) {\n    const patient = matches[0];\n    return JSON.stringify({\n      success: true,\n      matchFound: true,\n      matchType: 'SINGLE_MATCH',\n      patient: {\n        patientId: patient.patientId,\n        firstName: patient.firstName,\n        lastName: patient.lastName,\n        fullName: `${patient.firstName} ${patient.lastName}`,\n        dateOfBirth: patient.dateOfBirth,\n        primaryPhone: patient.primaryPhone,\n        email: patient.email,\n        location: patient.location,\n        isExistingPatient: patient.isExistingPatient,\n        hasUpcomingAppointment: patient.hasUpcomingAppointment,\n        nextAppointment: patient.nextAppointment\n      },\n      message: `Found patient: ${patient.firstName} ${patient.lastName}`\n    }, null, 2);\n  }\n  \n  // Multiple matches\n  return JSON.stringify({\n    success: false,\n    matchFound: true,\n    matchType: 'MULTIPLE_MATCHES',\n    matches: matches.map(p => ({\n      patientId: p.patientId,\n      firstName: p.firstName,\n      lastName: p.lastName,\n      dateOfBirth: p.dateOfBirth\n    })),\n    message: `Found ${matches.length} patient records. Please provide Date of Birth for verification.`,\n    requiresDOB: true\n  }, null, 2);\n  \n} catch (error) {\n  console.error('Patient match error:', error);\n  return JSON.stringify({\n    success: false,\n    error: error.message,\n    message: 'Patient lookup temporarily unavailable. Please try again.'\n  });\n}",
  "workspaceId": "9e7c759d-2623-4529-945d-6c578631aad0"
}

