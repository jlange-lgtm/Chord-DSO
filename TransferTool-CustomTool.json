{
  "name": "TransferTool",
  "description": "Routes calls to live agents, Patient Services Center (PSC), voicemail, or emergency services. Includes whisper context to provide live agents with caller information, intent, and conversation history. Handles business hours, after-hours, and emergency routing.",
  "color": "linear-gradient(rgb(68,211,235), rgb(86,81,165))",
  "iconSrc": "",
  "schema": "[{\"id\":0,\"property\":\"transferType\",\"type\":\"string\",\"description\":\"Type of transfer: 'LiveAgent', 'PSC', 'Voicemail', 'Emergency', 'Office' (required)\",\"required\":true},{\"id\":1,\"property\":\"transferReason\",\"type\":\"string\",\"description\":\"Reason for transfer (e.g., 'DOB_Failed', 'No_Availability', 'API_Error', 'Patient_Request') (required)\",\"required\":true},{\"id\":2,\"property\":\"patientName\",\"type\":\"string\",\"description\":\"Patient's full name (for whisper context)\",\"required\":false},{\"id\":3,\"property\":\"patientDOB\",\"type\":\"string\",\"description\":\"Patient's date of birth (for whisper context)\",\"required\":false},{\"id\":4,\"property\":\"patientId\",\"type\":\"string\",\"description\":\"Patient ID (for whisper context)\",\"required\":false},{\"id\":5,\"property\":\"intent\",\"type\":\"string\",\"description\":\"Caller's intent: 'SCH', 'RESCH', 'CXL', 'CONF', 'FAQ', 'LP', 'OTHER' (for whisper context)\",\"required\":false},{\"id\":6,\"property\":\"language\",\"type\":\"string\",\"description\":\"Caller's language preference: 'en' or 'es' (for whisper context)\",\"required\":false},{\"id\":7,\"property\":\"appointmentData\",\"type\":\"string\",\"description\":\"Appointment information in JSON format (for whisper context)\",\"required\":false},{\"id\":8,\"property\":\"conversationSummary\",\"type\":\"string\",\"description\":\"Brief summary of conversation (for whisper context)\",\"required\":false},{\"id\":9,\"property\":\"isEmergency\",\"type\":\"boolean\",\"description\":\"Whether this is an emergency call (default: false)\",\"required\":false},{\"id\":10,\"property\":\"isAfterHours\",\"type\":\"boolean\",\"description\":\"Whether call is after business hours (default: false)\",\"required\":false}]",
  "func": "/*\n* Transfer Tool - Route calls to live agents and other services\n* You can use properties: $transferType, $transferReason, $patientName, $patientDOB, $patientId, $intent, $language, $appointmentData, $conversationSummary, $isEmergency, $isAfterHours\n* Must return a string value at the end of function\n*/\n\n// Transfer destinations\nconst transferDestinations = {\n  LiveAgent: {\n    phoneNumber: null, // Would be configured in real system\n    extension: null,\n    description: 'Live Agent'\n  },\n  PSC: {\n    phoneNumber: null, // Patient Services Center\n    extension: null,\n    description: 'Patient Services Center'\n  },\n  Voicemail: {\n    phoneNumber: null,\n    extension: 'voicemail',\n    description: 'Office Voicemail'\n  },\n  Emergency: {\n    phoneNumber: '6105260801',\n    extension: '616669',\n    description: 'Emergency Service'\n  },\n  Office: {\n    phoneNumber: null, // Office main line\n    extension: null,\n    description: 'Office'\n  }\n};\n\n// Business hours check\nfunction isBusinessHours() {\n  const now = new Date();\n  const day = now.getDay(); // 0 = Sunday, 6 = Saturday\n  const hour = now.getHours();\n  \n  // Monday-Friday, 7am-7pm (simplified)\n  if (day >= 1 && day <= 5 && hour >= 7 && hour < 19) {\n    return true;\n  }\n  return false;\n}\n\ntry {\n  const transferType = $transferType;\n  const transferReason = $transferReason;\n  \n  if (!transferType || !transferReason) {\n    return JSON.stringify({\n      success: false,\n      error: 'Transfer type and reason are required',\n      message: 'Please specify transfer type and reason'\n    });\n  }\n  \n  // Validate transfer type\n  const validTypes = ['LiveAgent', 'PSC', 'Voicemail', 'Emergency', 'Office'];\n  if (!validTypes.includes(transferType)) {\n    return JSON.stringify({\n      success: false,\n      error: 'Invalid transfer type',\n      message: `Transfer type must be one of: ${validTypes.join(', ')}`\n    });\n  }\n  \n  // Determine actual destination based on conditions\n  let actualDestination = transferType;\n  const isAfterHours = $isAfterHours !== undefined ? $isAfterHours : !isBusinessHours();\n  const isEmergency = $isEmergency || false;\n  \n  // Handle emergency routing\n  if (isEmergency) {\n    if (isAfterHours) {\n      actualDestination = 'Emergency';\n    } else {\n      actualDestination = 'Office';\n    }\n  }\n  \n  // Handle after-hours routing for non-emergency\n  if (isAfterHours && !isEmergency && transferType === 'LiveAgent') {\n    actualDestination = 'PSC';\n  }\n  \n  // Build whisper context\n  const whisperContext = {\n    transferReason: transferReason,\n    patientName: $patientName || 'Not provided',\n    patientDOB: $patientDOB || 'Not provided',\n    patientId: $patientId || 'Not provided',\n    intent: $intent || 'Not provided',\n    language: $language || 'en',\n    appointmentData: $appointmentData ? JSON.parse($appointmentData) : null,\n    conversationSummary: $conversationSummary || 'No summary provided',\n    timestamp: new Date().toISOString()\n  };\n  \n  // Format whisper message\n  const whisperMessage = `Call Transfer - Reason: ${transferReason}. ` +\n    `Patient: ${whisperContext.patientName} (ID: ${whisperContext.patientId}). ` +\n    `Intent: ${whisperContext.intent}. ` +\n    `Language: ${whisperContext.language}. ` +\n    `Summary: ${whisperContext.conversationSummary}`;\n  \n  const destination = transferDestinations[actualDestination] || transferDestinations.LiveAgent;\n  \n  const transferResult = {\n    transferType: transferType,\n    actualDestination: actualDestination,\n    destination: destination,\n    transferReason: transferReason,\n    whisperContext: whisperContext,\n    whisperMessage: whisperMessage,\n    isEmergency: isEmergency,\n    isAfterHours: isAfterHours,\n    transferInitiated: true,\n    timestamp: new Date().toISOString()\n  };\n  \n  return JSON.stringify({\n    success: true,\n    operation: 'transferCall',\n    result: transferResult,\n    message: `Call transfer initiated to ${destination.description}. Whisper context prepared.`\n  }, null, 2);\n  \n} catch (error) {\n  console.error('Transfer tool error:', error);\n  return JSON.stringify({\n    success: false,\n    error: error.message,\n    message: 'Transfer temporarily unavailable. Please try again.'\n  });\n}",
  "workspaceId": "9e7c759d-2623-4529-945d-6c578631aad0"
}

