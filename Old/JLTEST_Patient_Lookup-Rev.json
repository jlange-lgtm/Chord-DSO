{
  "name": "JLTEST_Patient_Lookup-CustomTool",
  "description": "Use this tool to search for a patient by date of birth using the NexHealth API. This tool queries the NexHealth API to find patient records matching the provided date of birth.",
  "color": "linear-gradient(rgb(206,44,2), rgb(165,181,23))",
  "iconSrc": "",
  "schema": "[{\"id\":0,\"property\":\"dateOfBirth\",\"description\":\"The date of birth of the patient to search for (format: YYYY-MM-DD).\",\"type\":\"string\",\"required\":true}]",
  "func": "const fetch = require('node-fetch');\nconst dateOfBirth = $dateOfBirth;\n\nconst apiKey = `dXNlci0yNzQtcHJvZHVjdGlvbg.eqAjEe1KyadP0pZ56bNbULBObZG3VKqU`;\n\nconst myHeaders = {\n    \"Accept\": \"application/vnd.Nexhealth+json;version=2\",\n    \"Authorization\": apiKey\n};\n\nconst requestOptions = {\n    method: \"POST\",\n    headers: myHeaders,\n    redirect: \"follow\"\n};\n\n// First, authenticate to get the token\nreturn fetch(\"https://nexhealth.info/authenticates\", requestOptions)\n    .then((response) => response.json())\n    .then((authResult) => {\n        console.log('Auth response:', authResult);\n        const authToken = authResult.data.token;\n        console.log('Auth Token:', authToken);\n\n        // Now search for patients with the auth token\n        const patientHeaders = {\n            \"Accept\": \"application/vnd.Nexhealth+json;version=2\",\n            \"Authorization\": \"Bearer \" + authToken\n        };\n\n        const patientRequestOptions = {\n            method: \"GET\",\n            headers: patientHeaders,\n            redirect: \"follow\"\n        };\n\n        return fetch(`https://nexhealth.info/patients?subdomain=cdm&location_id=333725&date_of_birth=${dateOfBirth}`, patientRequestOptions);\n    })\n    .then((response) => response.json())\n    .then((result) => {\n        console.log('Patient search result:', result);\n        \n        // Log the count of patients found for debugging\n        if (result && result.data && result.data.patients && Array.isArray(result.data.patients)) {\n            const patientCount = result.data.patients.length;\n            console.log(`Found ${patientCount} patient(s) with date of birth ${dateOfBirth}`);\n            console.log(`Patients array length: ${patientCount}`);\n        }\n        \n        // Return the full response structure\n        // The API returns: {code, description, error, data: {patients: [...]}}\n        // The patients array is in result.data.patients\n        const patientResult = result;\n        console.log('Full patient result structure:', {\n            code: patientResult.code,\n            hasData: !!patientResult.data,\n            patientsCount: patientResult.data && patientResult.data.patients ? patientResult.data.patients.length : 0\n        });\n        \n        return patientResult;\n    })\n    .catch((error) => {\n        console.error('Error:', error);\n        throw error;\n    });",
  "workspaceId": "9e7c759d-2623-4529-945d-6c578631aad0"
}