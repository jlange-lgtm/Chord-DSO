{
  "name": "JLTEST_Cancel_Appt-CustomTool",
  "description": "Use this tool to cancel an existing appointment using the NexHealth API. This tool updates the appointment status to cancelled.",
  "color": "linear-gradient(rgb(200,50,50), rgb(150,50,50))",
  "iconSrc": "",
  "schema": "[{\"id\":0,\"property\":\"appointmentId\",\"description\":\"The appointment ID to cancel.\",\"type\":\"string\",\"required\":true},{\"id\":1,\"property\":\"reason\",\"description\":\"Optional reason for cancellation.\",\"type\":\"string\",\"required\":false}]",
  "func": "const fetch = require('node-fetch');\nconst appointmentId = $appointmentId;\nconst reason = (typeof $reason !== 'undefined' && $reason) ? $reason : \"Cancelled by patient\";\n\nconst apiKey = `dXNlci0yNzQtcHJvZHVjdGlvbg.eqAjEe1KyadP0pZ56bNbULBObZG3VKqU`;\n\nconst myHeaders = {\n    \"Accept\": \"application/vnd.Nexhealth+json;version=2\",\n    \"Authorization\": apiKey\n};\n\nconst requestOptions = {\n    method: \"POST\",\n    headers: myHeaders,\n    redirect: \"follow\"\n};\n\n// First, authenticate to get the token\nreturn fetch(\"https://nexhealth.info/authenticates\", requestOptions)\n    .then((response) => response.json())\n    .then((authResult) => {\n        console.log('Auth response:', authResult);\n        const authToken = authResult.data.token;\n        console.log('Auth Token:', authToken);\n\n        // Now cancel the appointment with the auth token\n        const apptHeaders = {\n            \"Content-Type\": \"application/json\",\n            \"Accept\": \"application/vnd.Nexhealth+json;version=2\",\n            \"Authorization\": \"Bearer \" + authToken\n        };\n\n        const raw = JSON.stringify({\n            \"appt\": {\n                \"cancelled\": true,\n                \"cancellation_reason\": reason\n            }\n        });\n\n        const apptRequestOptions = {\n            method: \"PATCH\",\n            headers: apptHeaders,\n            body: raw,\n            redirect: \"follow\"\n        };\n\n        return fetch(`https://nexhealth.info/appointments/${appointmentId}?subdomain=cdm&id=${appointmentId}`, apptRequestOptions);\n    })\n    .then((response) => response.json())\n    .then((result) => {\n        console.log('Appointment cancelled:', result);\n        const apptResult = result;\n        console.log(apptResult);\n        return apptResult;\n    })\n    .catch((error) => {\n        console.error('Error:', error);\n        throw error;\n    });",
  "workspaceId": "9e7c759d-2623-4529-945d-6c578631aad0"
}

