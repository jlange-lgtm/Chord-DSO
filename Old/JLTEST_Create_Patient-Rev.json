{
  "name": "JLTEST_Create_Patient-CustomTool",
  "description": "Use this tool to create a new patient in the NexHealth system. This tool creates a new patient record with the provided information.",
  "color": "linear-gradient(rgb(100,150,200), rgb(200,100,150))",
  "iconSrc": "",
  "schema": "[{\"id\":0,\"property\":\"firstName\",\"description\":\"The patient's first name.\",\"type\":\"string\",\"required\":true},{\"id\":1,\"property\":\"lastName\",\"description\":\"The patient's last name.\",\"type\":\"string\",\"required\":true},{\"id\":2,\"property\":\"dateOfBirth\",\"description\":\"The patient's date of birth (format: YYYY-MM-DD).\",\"type\":\"string\",\"required\":true},{\"id\":3,\"property\":\"phoneNumber\",\"description\":\"The patient's phone number.\",\"type\":\"string\",\"required\":true},{\"id\":4,\"property\":\"email\",\"description\":\"The patient's email address. Can be empty string or omitted if not provided.\",\"type\":\"string\",\"required\":false},{\"id\":5,\"property\":\"address\",\"description\":\"The patient's address. Can be empty string or omitted if not provided.\",\"type\":\"string\",\"required\":false}]",
  "func": "const fetch = require('node-fetch');\nlet firstName = null;\nlet lastName = null;\nlet dateOfBirth = null;\nlet phoneNumber = null;\nlet email = null;\nlet address = null;\n\ntry { firstName = ($firstName && $firstName !== null && $firstName !== 'null') ? String($firstName).trim() : null; } catch(e) { firstName = null; }\ntry { lastName = ($lastName && $lastName !== null && $lastName !== 'null') ? String($lastName).trim() : null; } catch(e) { lastName = null; }\ntry { dateOfBirth = ($dateOfBirth && $dateOfBirth !== null && $dateOfBirth !== 'null') ? String($dateOfBirth).trim() : null; } catch(e) { dateOfBirth = null; }\ntry { phoneNumber = ($phoneNumber && $phoneNumber !== null && $phoneNumber !== 'null') ? String($phoneNumber).trim() : null; } catch(e) { phoneNumber = null; }\ntry { \n    if ($email !== undefined && $email !== null && $email !== 'null' && String($email).trim() !== '') {\n        email = String($email).trim();\n    } else {\n        email = null;\n    }\n} catch(e) { email = null; }\ntry { \n    if ($address !== undefined && $address !== null && $address !== 'null' && String($address).trim() !== '') {\n        address = String($address).trim();\n    } else {\n        address = null;\n    }\n} catch(e) { address = null; }\n\nconst apiKey = `dXNlci0yNzQtcHJvZHVjdGlvbg.eqAjEe1KyadP0pZ56bNbULBObZG3VKqU`;\n\nconst myHeaders = {\n    \"Accept\": \"application/vnd.Nexhealth+json;version=2\",\n    \"Authorization\": apiKey\n};\n\nconst requestOptions = {\n    method: \"POST\",\n    headers: myHeaders,\n    redirect: \"follow\"\n};\n\n// First, authenticate to get the token\nreturn fetch(\"https://nexhealth.info/authenticates\", requestOptions)\n    .then((response) => response.json())\n    .then((authResult) => {\n        console.log('Auth response:', authResult);\n        const authToken = authResult.data.token;\n        console.log('Auth Token:', authToken);\n\n        // Now create the patient with the auth token\n        const patientHeaders = {\n            \"Content-Type\": \"application/json\",\n            \"Accept\": \"application/vnd.Nexhealth+json;version=2\",\n            \"Authorization\": \"Bearer \" + authToken\n        };\n\n        // Validate required fields\n        if (!firstName || !lastName || !dateOfBirth || !phoneNumber) {\n            throw new Error('Missing required fields: firstName, lastName, dateOfBirth, and phoneNumber are required');\n        }\n\n        // Build patient data in the required nested structure\n        // Note: Provider may be required by API but we don't have provider_id at patient creation\n        // The API may use a default provider for the location\n        const patientData = {\n            \"patient\": {\n                \"first_name\": firstName,\n                \"last_name\": lastName,\n                \"email\": (email && email !== null && email !== 'null') ? email : \"\",\n                \"bio\": {\n                    \"date_of_birth\": dateOfBirth,\n                    \"phone_number\": phoneNumber\n                }\n            }\n        };\n        \n        // Note: If provider is required, the API may use location-based default\n        // We're not including provider here as it's not available at patient creation time\n\n        // Add address if provided\n        if (address && address !== null && address !== 'null' && address.trim() !== '') {\n            patientData.patient.address = address;\n        }\n\n        const raw = JSON.stringify(patientData);\n\n        const patientRequestOptions = {\n            method: \"POST\",\n            headers: patientHeaders,\n            body: raw,\n            redirect: \"follow\"\n        };\n\n        return fetch(\"https://nexhealth.info/patients?subdomain=cdm&location_id=333725\", patientRequestOptions);\n    })\n    .then((response) => response.json())\n    .then((result) => {\n        console.log('Patient created:', result);\n        const patientResult = result;\n        console.log(patientResult);\n        return patientResult;\n    })\n    .catch((error) => {\n        console.error('Error:', error);\n        throw error;\n    });",
  "workspaceId": "9e7c759d-2623-4529-945d-6c578631aad0"
}

