{
  "name": "chordEnh_getApptSlots",
  "description": "This tool is used to fetch the appointment slots available for patients to book a new appointment at the medical practice.",
  "color": "linear-gradient(rgb(115,210,197), rgb(212,167,186))",
  "iconSrc": "",
  "schema": "[]",
  "func": "const fetch = require('node-fetch');\n\nconst apiKey = `dXNlci0yNzQtcHJvZHVjdGlvbg.eqAjEe1KyadP0pZ56bNbULBObZG3VKqU`;\nconst providerId = 223076809;\nconst startDate = \"2026-04-13\";\nconst days = 14;\nconst locationId = 77523;\n\n// Limit the number of slots returned (set to null or 0 to return all slots)\nconst maxSlots = 3;\n\nlet myHeaders = new Headers();\nmyHeaders.append(\"Accept\", \"application/vnd.Nexhealth+json;version=2\");\nmyHeaders.append(\"Authorization\", apiKey);\n\nconst requestOptions = {\n    method: \"POST\",\n    headers: myHeaders,\n    redirect: \"follow\"\n};\n\n// Return the promise chain so the result is properly returned\nreturn fetch(\"https://nexhealth.info/authenticates\", requestOptions)\n    .then((response) => {\n        if (!response.ok) {\n            return response.text().then(errorText => {\n                throw new Error(`Authentication failed with status ${response.status}: ${errorText}`);\n            });\n        }\n        return response.json();\n    })\n    .then((authResult) => {\n        if (!authResult.data || !authResult.data.token) {\n            throw new Error('Authentication token not found in response');\n        }\n        const authToken = authResult.data.token;\n\n        // Now make the second request with the auth token\n        const apptHeaders = new Headers();\n        apptHeaders.append(\"Accept\", \"application/vnd.Nexhealth+json;version=2\");\n        apptHeaders.append(\"Authorization\", `Bearer ${authToken}`);\n\n        const apptRequestOptions = {\n            method: \"GET\",\n            headers: apptHeaders,\n            redirect: \"follow\"\n        };\n\n        return fetch(\"https://nexhealth.info/appointment_slots?subdomain=cdm&lids[]=\" + locationId + \"&pids[]=\" + providerId + \"&start_date=\" + startDate + \"&days=\" + days + \"&location_id=\" + locationId, apptRequestOptions);\n    })\n    .then((response) => {\n        if (!response.ok) {\n            return response.text().then(errorText => {\n                throw new Error(`Get appointment slots failed with status ${response.status}: ${errorText}`);\n            });\n        }\n        return response.json();\n    })\n    .then((result) => {\n        // Validate response structure\n        if (!result.data) {\n            return JSON.stringify({\n                success: true,\n                message: 'No data found in appointment slots response',\n                data: []\n            });\n        }\n\n        if (!Array.isArray(result.data) || result.data.length === 0) {\n            return JSON.stringify({\n                success: true,\n                message: 'No appointment slots available for the specified criteria',\n                data: []\n            });\n        }\n\n        if (!result.data[0].slots) {\n            return JSON.stringify({\n                success: true,\n                message: 'No appointment slots available for the specified provider',\n                data: []\n            });\n        }\n        \n        const allSlots = result.data[0].slots;\n        \n        // Apply maxSlots limit if specified (null or 0 means return all)\n        let apptSlots;\n        if (maxSlots === null || maxSlots === 0) {\n            apptSlots = allSlots;\n        } else {\n            apptSlots = allSlots.slice(0, maxSlots);\n        }\n        \n        return JSON.stringify({\n            success: true,\n            message: `Found ${allSlots.length} appointment slots, returning ${apptSlots.length}`,\n            totalSlots: allSlots.length,\n            returnedSlots: apptSlots.length,\n            maxSlotsLimit: maxSlots || 'unlimited',\n            data: apptSlots\n        });\n    })\n    .catch((error) => {\n        console.error('Error:', error);\n        return JSON.stringify({\n            success: false,\n            error: error.message || 'Unknown error occurred while fetching appointment slots',\n            errorType: error.name || 'Error',\n            timestamp: new Date().toISOString()\n        });\n    });",
  "workspaceId": "9e7c759d-2623-4529-945d-6c578631aad0"
}